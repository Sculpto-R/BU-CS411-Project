{% extends "base.html" %}
{% block main_class %}fullscreen{% endblock %}
{% block content %}
<div id="map" style="height:100vh;width:100%;"></div>

<style>
        html, body { height: 100%; margin: 0; padding: 0; }
        #map { height: 100vh; width: 100%; }
        header, nav, .ui-elements { position: relative; z-index: 1000; }
</style>

{# Pass scraped events (from CSV) into JS safely #}
{{ scraped_events|json_script:"scraped-events-data" }}

<script>
    function initMap() {
        const london = { lat: 51.5074, lng: -0.1278 };
        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 11,
            center: london,
        });

        // Parse scraped events passed from Django view
        const events = JSON.parse(document.getElementById('scraped-events-data').textContent || '[]');

        events.forEach(event => {
            const marker = new google.maps.Marker({
                position: { lat: event.lat, lng: event.lng },
                map: map,
                title: event.name
            });

            const infowindow = new google.maps.InfoWindow({
                content: `
                    <div style="font-family:Arial,sans-serif;">
                        <h3 style="margin:0;">${event.name}</h3>
                        <p style="margin:0;"><b>Address:</b> ${event.address}</p>
                        <p style="margin:0;"><b>Date:</b> ${event.date}</p>
                    </div>
                `
            });

            marker.addListener("click", () => {
                infowindow.open(map, marker);
            });
        });
    }
</script>

<script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2tWZApy0oF5lBrlK0rmjfX0DFa3dk8do&callback=initMap">
</script>
{% endblock %}
